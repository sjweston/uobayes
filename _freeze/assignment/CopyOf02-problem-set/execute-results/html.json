{
  "hash": "656b29d5cea7466baa535023cf625109",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Problem set 2\"\ndate: \"2025-04-14\"\n---\n\n\n\n\n\n## Instructions\n\nPlease use an RMarkdown file to complete this assignment. Make sure you reserve code chunks for code and write out any interpretations or explanations outside of code chunks. Submit the knitted PDF file containing your code and written answers on Canvas. \n\n## Questions\n\nFrom the `Howell1` dataset, consider only people younger than 13 years old. Estimate the causal association between age and weight. Assume that age influences weight through two paths. First, age influences height, and\nheight influences weight. Second, age directly influences weight through age-related changes in muscle growth and body proportions. \n\n1. Write a generative simulation that takes age as an input and simulates height and weight.\n\n<details>\n<summary>Click to see the answer</summary>\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Define the simulation function\nsimulate_growth <- function(age) {\n  n = length(age)\n  # Simulate height (in feet)\n  height <- rnorm(n, \n                 mean = 1.5 + .3*age + 0.005*age^2,  # Quadratic growth pattern\n                 sd = .3)                           # Random variation\n  \n  # Simulate weight (in lb)\n  weight <- rnorm(n,\n                 mean = 6.5 + 5*age + 0.25*height, # Linear relationship with age and height\n                 sd = 4)                           # Random variation\n  \n  data.frame(age=age, height=height, weight=weight)\n}\n\n# Generate data for ages 0-12\nages <- runif(100, 0, 12)\nsim_data = simulate_growth(ages)\n\n# Plot the simulated relationships\npar(mfrow=c(2,1))\nplot(sim_data$age, sim_data$height, \n     xlab=\"Age (years)\", ylab=\"Height (feet)\",\n     main=\"Age vs Height\")\nplot(sim_data$age, sim_data$weight,\n     xlab=\"Age (years)\", ylab=\"Weight (lb)\",\n     main=\"Age vs Weight\")\n```\n\n::: {.cell-output-display}\n![](CopyOf02-problem-set_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nThis simulation:\n\n  1. Takes age as input and generates both height and weight\n  2. Uses a quadratic function for height to capture the non-linear growth pattern\n  3. Uses a linear function for weight that depends on both age and height\n  4. Includes random variation (noise) in both height and weight\n  5. The plots show the expected relationships: both height and weight increase with age\n\n</details>\n\n2. Write out a mathematical model to estimate the linear relationship between age and weight. \n\n<details>\n<summary>Click to see the answer</summary>\n\nThere are many priors that could be appropriate here. Don't worry if yours looks different from mine. Here's just one example:\n\n\\begin{align*}\nW_i &\\sim \\text{Normal}(\\mu_i, \\sigma) \\\\\n\\mu_i &= \\alpha + (\\beta_A * A_i)\\\\\n\\alpha &\\sim  \\text{Normal}(7, 1.5)  \\\\\n\\beta_A &\\sim \\text{Normal}(0, 1) \\\\\n\\sigma &\\sim \\text{Exponential}(1)\n\\end{align*}\n\nWhere:\n\n  - $W_i$ is the weight of individual $i$\n  - $A_i$ is the age of individual $i$\n  - $\\alpha$ is the intercept\n  - $\\beta_A$ is the effect of age on weight\n  - $\\sigma$ is the standard deviation of the weight distribution\n\nThis model:\n\n  1. Assumes weight is normally distributed around a mean $\\mu$\n  2. The mean $\\mu$ is a linear function of age\n  3. Uses weakly informative priors for all parameters\n  4. The exponential prior on $\\sigma$ ensures it's positive\n\n</details>\n\n3. Fit this model using `brms`. Create two plots: one of regression lines implied by your prior and one of the regression lines implied by the posterior.\n\n<details>\n<summary>Click to see the answer</summary>\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(brms)\nlibrary(tidyverse)\nlibrary(cowplot)\ndata(\"Howell1\", package=\"rethinking\")\n\n# Filter for children under 13\nd <- Howell1[Howell1$age < 13,]\n\n# Define the model\nmp <- brm(\n  weight ~ age,\n  data = d,\n  prior = c(\n    prior(normal(7, 1.5), class = Intercept),\n    prior(normal(0, 1), class = b),\n    prior(exponential(1), class = sigma)\n  ),\n  sample_prior = \"only\"  # First get prior samples\n)\n\n# Get prior samples\nprior_samples <- as_draws_df(mp)\n\n\n# Now fit the model with the data\nm <- brm(\n  weight ~ age,\n  data = d,\n  prior = c(\n    prior(normal(7, 1.5), class = Intercept),\n    prior(normal(0, 1), class = b),\n    prior(exponential(1), class = sigma)\n  )\n)\n\n# Get posterior samples\npost_samples <- as_draws_df(m)\n\np1 <- ggplot(d, aes(x=age, y=weight)) + \n  geom_blank() +\n  geom_abline(aes(intercept=b_Intercept, slope=b_age),\n              data=prior_samples[1:50, ],\n              alpha=.2)\np2 <- ggplot(d, aes(x=age, y=weight)) + \n  geom_point() +\n  geom_abline(aes(intercept=b_Intercept, slope=b_age),\n              data=post_samples[1:50, ],\n              alpha=.2)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(patchwork)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'patchwork'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:cowplot':\n\n    align_plots\n```\n\n\n:::\n\n```{.r .cell-code}\n(p1 | p2)\n```\n\n::: {.cell-output-display}\n![](CopyOf02-problem-set_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nThe plots show:\n\n  1. Prior regression lines: These show our uncertainty before seeing the data. The lines are widely spread, reflecting our weak priors.\n  2. Posterior regression lines: These show our uncertainty after seeing the data. The lines are much more concentrated, showing that the data has informed our estimates.\n\nThe model summary shows the estimated effects of age and height on weight, along with their uncertainty. The standardized coefficients allow us to compare the relative importance of age and height in predicting weight.\n\n</details>\n",
    "supporting": [
      "CopyOf02-problem-set_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}