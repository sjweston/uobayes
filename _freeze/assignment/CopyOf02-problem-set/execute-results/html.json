{
  "hash": "d55abbe17ad96686623976ff58d76d47",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Problem set 2\"\ndate: \"2025-04-14\"\n---\n\n\n\n\n\n## Instructions\n\nPlease use an RMarkdown file to complete this assignment. Make sure you reserve code chunks for code and write out any interpretations or explanations outside of code chunks. Submit the knitted PDF file containing your code and written answers on Canvas. \n\n## Questions\n\nFrom the `Howell1` dataset, consider only people younger than 13 years old. Estimate the causal association between age and weight. Assume that age influences weight through two paths. First, age influences height, and\nheight influences weight. Second, age directly influences weight through age-related changes in muscle growth and body proportions. \n\n1. Draw the DAG that represents these causal relationships. \n\n<details>\n<summary>Click to see the answer</summary>\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(dagitty)\nlibrary(ggplot2)\n\n# Create the DAG\ndag <- dagitty(\"dag {\n  A [age]\n  H [height]\n  W [weight]\n  A -> H\n  H -> W\n  A -> W\n}\")\n\n# Plot the DAG\nplot(dag)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nPlot coordinates for graph not supplied! Generating coordinates, see ?coordinates for how to set your own.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](CopyOf02-problem-set_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nThe DAG shows three variables (age, height, and weight) with directed edges representing causal relationships. There are two paths from age to weight:\n1. A direct path: age → weight (representing age-related changes in muscle growth and body proportions)\n2. An indirect path: age → height → weight (representing the influence of age on height, which then affects weight)\n\n</details>\n\n2. Write a generative simulation that takes age as an input and simulates height and weight, obeying the relationships in the DAG.\n\n<details>\n<summary>Click to see the answer</summary>\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nset.seed(1)\n# Function to simulate data\n# i'm using feet/pounds, but you can stick with metric if you prefer\nsimulate_growth <- function(age, bAH=0.35, bHW=5, bAW=5) {\n  N <- length(age) # num individuals\n  # simulate heights (caused by age plus variation)\n  height <- rnorm(N, bAH*age, .2) \n  # simulate heights (caused by age and height plus variation)\n  weight <- rnorm(N, bAW*age + bHW*height, 4) \n  #return data frame\n  data.frame(age, height, weight)\n  \n}\n\nsim = simulate_growth( runif(n=20, min=1, max=12)  )\n\npar(mfrow = c(1, 3))\nplot(sim$age, sim$height)\nplot(sim$age, sim$weight)\nplot(sim$height, sim$weight)\n```\n\n::: {.cell-output-display}\n![](CopyOf02-problem-set_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nThis simulation:\n1. Takes age as input\n2. Generates height using a function of age \n3. Generates weight as a function of both age (direct effect) and height (indirect effect)\n4. Includes random variation (noise) in both height and weight\n\nThe plots show the expected relationships: both height and weight increase with age and height and weight are linearlly related. \n\n</details>\n\n3. Estimate the **total** causal effect of each year of growth on weight. Be sure to simulate your priors before estimating the model on the data. \n\n<details>\n<summary>Click to see the answer</summary>\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Load the Howell1 dataset\nlibrary(rethinking)\ndata(Howell1)\n\n# Filter for children under 13\nd <- Howell1[Howell1$age < 13,]\n\n# convert to lbs\nlibrary(measurements)\nd$weight <- conv_unit(d$weight, from = \"kg\", to = \"lbs\")\n```\n:::\n\n\n\nThe linear model for this relationship includes both an intercept and a slope -- I need priors for these. The intercept is the weight of a child who is 0 (i.e., weight at birth). The slope is expected (average) change (gain) in weight each year. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# priors\nn <- 10 #number of lines to simulate\na_prior = rnorm(n, 7, 2) #intercept\nb_prior = runif(n, 0, 8) #slope\nplot(NULL, \n     xlim = range(d$age),    xlab = \"age\",\n     ylim = range(d$weight), ylab=\"weight\")\nfor( i in 1:n ) abline( a_prior[i], b_prior[i], col = \"#1c5253\")\n```\n\n::: {.cell-output-display}\n![](CopyOf02-problem-set_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\nThat's fine. I'll estimate the model usinbg `quap`.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm <- quap(\n  data = d, \n  alist(\n    weight ~ dnorm( mu, sigma),\n    mu <- a + b*age, \n    a ~ dnorm(7,2),\n    b ~ dunif(0,8),\n    sigma ~ dexp(1)\n  )\n)\nprecis(m)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           mean        sd      5.5%     94.5%\na     15.142366 0.7464192 13.949444 16.335288\nb      3.115430 0.1151904  2.931333  3.299526\nsigma  5.510017 0.3183555  5.001224  6.018811\n```\n\n\n:::\n:::\n\n\n\n\nThe total causal effect represents the combined impact of age on weight through both paths in the DAG:\n1. Direct effect: age → weight (changes in muscle growth and body proportions)\n2. Indirect effect: age → height → weight (growth in height affecting weight)\n\nThe posterior distribution shows our uncertainty about this total effect. The mean effect tells us how much weight we expect to increase per year of age, on average, taking into account both direct and indirect paths.\n\n</details>\n",
    "supporting": [
      "CopyOf02-problem-set_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}