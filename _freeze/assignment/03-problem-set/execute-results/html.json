{
  "hash": "a583798e31a5ee739df3ab8eb16b52b5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Problem set 3\"\ndate: \"2025-04-21\"\n---\n\n\n\n\n\n\n## Instructions\n\nPlease use an RMarkdown file to complete this assignment. Make sure you reserve code chunks for code and write out any interpretations or explainations outside of code chunks. Submit the knitted PDF file containing your code and written answers on Canvas. \n\n## Questions\n\nThe following problems are based on the dataset `foxes` in the `rethinking` package. There are 116 foxes in 30 different urban groups living in England. Group sizes (`groupsize`) range from 2 to 8 individuals. Each group maintains its own urban territory. (Fox groups = street gangs.) Some territories are larger than others (`area`). Some territories have more food (`avgfood`) than others. We want to model the `weight` of each fox.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](03-problem-set_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\n1. Use the backdoor criterion and estimate the total causal influence of `area` on `avgfood.` What effect would increasing the area of a territory have on the amount of food inside it?\n\n<details>\n<summary>Click to see the answer</summary>\n\nBecause there are no backdoor paths from area to food, we don't need to add any additional variables to our model.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(brms)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Rcpp\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading 'brms' package (version 2.22.0). Useful instructions\ncan be found by typing help('brms'). A more detailed introduction\nto the package is available through vignette('brms_overview').\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'brms'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:stats':\n\n    ar\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidybayes)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'tidybayes'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:brms':\n\n    dstudent_t, pstudent_t, qstudent_t, rstudent_t\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /Users/sweston2/Library/CloudStorage/GoogleDrive-weston.sara@gmail.com/My Drive/Work (google drive)/teaching/uobayes\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(cowplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'cowplot'\n\nThe following object is masked from 'package:lubridate':\n\n    stamp\n```\n\n\n:::\n\n```{.r .cell-code}\ndata(foxes, package=\"rethinking\") #\nd <- foxes\n\nd = d %>% \n  mutate(\n    across(c(weight, area, avgfood, groupsize),\n    rethinking::standardize,\n    .names=\"z{.col}\")\n  )\n  \nm1 <- brm(\n  data=d,\n  family=gaussian,\n  zavgfood ~ 1 + zarea, # the 1 isn't necessary, but it can help to be explicit\n  prior = c( prior(normal(0, .2),  class=Intercept),\n             prior(normal(0, .5),  class=b),\n             prior(exponential(1), class=sigma)),\n  iter=5000, warmup=1000, seed=9, chains=1,\n  file=here(\"files/models/hw3.1\")\n)\n\nposterior_summary(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 Estimate  Est.Error        Q2.5        Q97.5\nb_Intercept -1.787205e-04 0.04232039  -0.0838172   0.08238894\nb_zarea      8.770416e-01 0.04351424   0.7933333   0.96055366\nsigma        4.755545e-01 0.03218740   0.4185124   0.54327122\nIntercept   -1.787205e-04 0.04232039  -0.0838172   0.08238894\nlprior      -1.575419e+00 0.15959423  -1.9002485  -1.28224394\nlp__        -8.011294e+01 1.23163672 -83.4136233 -78.71506088\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nas_draws_df(m1) %>% \n  ggplot( aes(x=b_zarea) ) +\n  stat_halfeye() +\n  geom_vline( aes(xintercept=0), linetype=\"dashed\" ) +\n  labs( x=\"area coefficient\",\n        title=\"effect on food\") +\n  scale_y_continuous( NULL, breaks=NULL) +\n  theme_cowplot()\n```\n\n::: {.cell-output-display}\n![](03-problem-set_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\nTerritory size has a large impact on food. These are standardized estimates, so I can interpret the coefficients similar to a correlation. An effect of .88 is very large. \n\n</details>\n\n2. Now infer the total causal impact of adding food to a territory on `weight.` Can you calculate a causal effect by simulating an intervention on food?\n\n<details>\n<summary>Click to see the answer</summary>\n\nAgain, there are no backdoor paths to close. \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm2 <- brm(\n  data=d,\n  family=gaussian,\n  zweight ~ 1 + zavgfood, \n  prior = c( prior(normal(0, .2),  class=Intercept),\n             prior(normal(0, .5),  class=b),\n             prior(exponential(1), class=sigma)),\n  iter=5000, warmup=1000, seed=9, chains=1,\n  file=here(\"files/models/hw3.2\")\n)\n\nposterior_summary(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 Estimate  Est.Error         Q2.5        Q97.5\nb_Intercept  2.419619e-03 0.08570397   -0.1605716    0.1727472\nb_zavgfood  -2.445427e-02 0.09455113   -0.2086561    0.1604316\nsigma        1.009087e+00 0.06707915    0.8887629    1.1466294\nIntercept    2.419619e-03 0.08570397   -0.1605716    0.1727472\nlprior      -6.553151e-01 0.15964801   -1.0596240   -0.4581927\nlp__        -1.661419e+02 1.28473002 -169.4740028 -164.7155693\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nas_draws_df(m2) %>% \n  ggplot( aes(x=b_zavgfood) ) +\n  stat_halfeye() +\n  geom_vline( aes(xintercept=0), linetype=\"dashed\" ) +\n  labs( x=\"food coefficient\",\n        title=\"effect on weight\") +\n  scale_y_continuous( NULL, breaks=NULL) +\n  theme_cowplot()\n```\n\n::: {.cell-output-display}\n![](03-problem-set_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\nThere doesn't seem to be an effect of food on weight. Strange!\n\nLet's simulate the intervention to be sure. \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nF0 = predicted_draws( object=m2, newdata=data.frame(zavgfood=0) ) %>% \n  select(zavgfood, .draw, .prediction)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAdding missing grouping variables: `.row`\n```\n\n\n:::\n\n```{.r .cell-code}\nF1 = predicted_draws( object=m2, newdata=data.frame(zavgfood=1) ) %>% \n  select(zavgfood, .draw, .prediction)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nAdding missing grouping variables: `.row`\n```\n\n\n:::\n\n```{.r .cell-code}\nfull_join(F0, F1) %>% \n  pivot_wider( names_from = zavgfood, \n               names_prefix = \"F\",\n               values_from = .prediction) %>% \n  mutate(diff = F1-F0) %>% \n  ggplot( aes(x=diff) ) +\n  stat_halfeye() +\n  geom_vline( aes(xintercept=0), linetype=\"dashed\" ) +\n  labs( x=\"predicted difference\",\n        title=\"effect on weight of increasing food\") +\n  scale_y_continuous( NULL, breaks=NULL) +\n  theme_cowplot()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(.row, zavgfood, .draw, .prediction)`\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](03-problem-set_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\nYep, definitely nothing going on here. \n\n</details>\n\n\n3. Now infer the direct causal impact of group size on `weight.` \n\n<details>\n<summary>Click to see the answer</summary>\n\nA minimal sufficient adjustment is to control for average food. You can also control for area if you want -- it won't affect the estimates. \n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm3 <- brm(\n  data=d,\n  family=gaussian,\n  zweight ~ 1 + zavgfood + zgroupsize, \n  prior = c( prior(normal(0, .2),  class=Intercept),\n             prior(normal(0, .5),  class=b),\n             prior(exponential(1), class=sigma)),\n  iter=5000, warmup=1000, seed=9, chains=1,\n  file=here(\"files/models/hw3.3\")\n)\n\nposterior_summary(m3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                  Estimate  Est.Error         Q2.5        Q97.5\nb_Intercept  -3.242852e-03 0.07882886   -0.1568576    0.1475536\nb_zavgfood    4.733933e-01 0.18289019    0.1122530    0.8309168\nb_zgroupsize -5.675697e-01 0.18288232   -0.9231742   -0.2034564\nsigma         9.603875e-01 0.06186165    0.8464977    1.0904399\nIntercept    -3.242852e-03 0.07882886   -0.1568576    0.1475536\nlprior       -2.025487e+00 0.76926517   -3.8605025   -0.9146187\nlp__         -1.619678e+02 1.34979695 -165.3045325 -160.2426179\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nas_draws_df(m3) %>% \n  select( starts_with(\"b_z\") ) %>% \n  pivot_longer( everything(), \n                names_prefix = \"b_z\" ) %>%\n  ggplot( aes(x=value, y=name) ) +\n  stat_halfeye() +\n  geom_vline( aes(xintercept=0), linetype=\"dashed\" ) +\n  labs( x=\"coefficient estimate\",\n        y=NULL,\n        title=\"direct effect on weight\") +\n  theme_cowplot()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Dropping 'draws_df' class as required metadata was removed.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](03-problem-set_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=672}\n:::\n:::\n\n\n\n\nBoth of these are direct effects, so let's include them in the same graph. As there is more food, the foxes are bigger. Checks out. But as group size gets larger, weight gets smaller _stratifying by food_. These effects are also roughly the same size, thus canceling each other out. That's why we didn't see a direct effect of food on weight.\n\n</details>\n\n\n4. Given all of these models, what do you think is going on with the foxes?\n\n<details>\n<summary>Click to see the answer</summary>\n\nLarger territories increase food, but food both increases weight and increases group size. In simple terms, the benefits of more food are canceled out by more foxes being attracted to the food, so each fox gets the same amount. \n\n</details>\n\n",
    "supporting": [
      "03-problem-set_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}